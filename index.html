<!DOCTYPE html>
<html>
  <head>
    <title>Street Art Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      #map {
        height: 400px;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <h1>Street Art Map</h1>
    <input type="file" id="fileInput" accept="image/*" multiple />
    <div id="map"></div>

    <script src="exif.js"></script>
    <script
      src="https://cors-anywhere.herokuapp.com/https://maps.googleapis.com/maps/api/js?key=AIzaSyCOqutgk6LhMkN4ji2NY7zaZ__aTz9l_H0&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <script>
      let map;
      const markers = [];

      function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 0, lng: 0 },
          zoom: 2,
        });
      }

      function addMarker(latitude, longitude, photoUrl) {
        const marker = new google.maps.Marker({
          position: { lat: latitude, lng: longitude },
          map: map,
          icon: photoUrl,
        });
        markers.push(marker);
        map.panTo(marker.getPosition());
      }

      function handleFileSelect(event) {
        const files = event.target.files;

        for (let i = 0; i < files.length; i++) {
          const file = files[i];
          const reader = new FileReader();

          reader.onload = function (e) {
            const photoUrl = e.target.result;
            const exifData = exif.readFromBinaryFile(e.target.result);

            let latitude = 0;
            let longitude = 0;

            if (exifData.GPSLatitude && exifData.GPSLongitude) {
              latitude = exifData.GPSLatitude.join(".");
              longitude = exifData.GPSLongitude.join(".");
            } else {
              console.log("No GPS data found in the EXIF data.");
            }

            addMarker(parseFloat(latitude), parseFloat(longitude), photoUrl);
          };

          reader.readAsDataURL(file);
        }
      }

      document
        .getElementById("fileInput")
        .addEventListener("change", handleFileSelect, false);
    </script>
  </body>
</html>
